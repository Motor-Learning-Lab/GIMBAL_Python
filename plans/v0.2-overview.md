# GIMBAL-HMM v0.2 Roadmap

This document defines version 0.2 of the GIMBAL-HMM project.  
Version 0.1 produced the three-stage architecture:

1. **Stage 1** ‚Äî Collapsed HMM engine (`collapsed_hmm_loglik`)  
2. **Stage 2** ‚Äî Camera + kinematics model exposing `U`, `x_all`, `y_pred`, `log_obs_t`  
3. **Stage 3** ‚Äî Directional HMM prior (`add_directional_hmm_prior`, `use_directional_hmm=True`)

v0.2 focuses on:  
**(a)** stability, **(b)** real-data capability, **(c)** diagnostics + priors, **(d)** dynamics via PCA-based HMMs, and **(e)** a clean selection of state count **S**.

All priors in Phases 0.2.1‚Äì0.2.2 are derived from the **current dataset**  
(synthetic now, later the AIST++ subset). The same machinery will later support large public datasets.

---

# üåü Version 0.2: Eight Phases

## Phase 0.2.1 ‚Äî Coarse Anatomical Priors & Basic Cleaning

**Purpose**  
Provide simple, stabilizing priors so that sampling and clustering behave sanely, even on synthetic data.

**Inputs**  
Current working dataset (synthetic for now).

**Scope**
- Derive per-joint direction priors from the skeleton and from the current dataset's empirical poses.  
- Encode weak constraints:
  - torso/head approximately vertical  
  - legs downward  
  - arms with broad but finite angular support  
- Add minimal pose/keypoint cleaning:
  - impossible distances  
  - physically absurd angles  
  - gross 2D outliers  
- Integrate these priors into Stage 3 as weak constraints.

**Outputs**
- Coarse anatomical priors for `mu` and optionally `kappa`.
- Slightly more stable Stage-3 sampling on synthetic data.

---

## Phase 0.2.2 ‚Äî k-Means / Clustering Empirical-Bayes Priors

**Purpose**  
Generate ‚Äúgross‚Äù emission and transition priors using simple clustering on the **current** dataset.

**Scope**
- Run k-means (or similar) on joint direction vectors or pose vectors.  
- Compute:
  - cluster means ‚Üí priors for canonical directions `mu_prior[s,k]`  
  - cluster spreads ‚Üí approximate Œ∫ priors  
  - cluster path ‚Üí empirical transition frequencies  
- Convert these into:
  - per-state direction priors  
  - per-state (or per-group) Œ∫ priors  
  - Dirichlet priors over transitions  

**Outputs**
- A simple EB-prior generator that stabilizes Stage 3 before sampler comparison.

---

## Phase 0.2.3 ‚Äî Sampler Decision Spike (With Priors in Place)

**Purpose**  
Decide between **nutpie** and a viable alternative (e.g., JAX-based HMC) before building the real-data pipeline.

**Scope**
- Run controlled comparisons on:
  - Stage-3 synthetic model  
  - optionally a very short AIST++ subsequence  
- Evaluate:
  - convergence (R-hat, ESS)  
  - runtime per effective sample  
  - robustness to moderate changes in T and S  

**Outputs**
- The v0.2 sampler decision + minimal tuning guidelines.

**Success Criterion**  
A sampler choice that is robust enough for Phases 0.2.4‚Äì0.2.8 without repeated reconsideration.

---

## Phase 0.2.4 ‚Äî Minimal Synthetic Diagnostics (Numeric + Visual)

**Purpose**  
Provide a fast ‚Äúhealth check‚Äù to detect broken fits early.

**Diagnostics (Numeric)**
- R-hat  
- ESS  
- Divergences  
- Optional: lightweight IC values if cheap (LOO/WAIC)

**Diagnostics (Visual)**
- State probabilities / occupancy  
- Transition matrix heatmap  
- Joint-direction figures for each state (arrows or unit-sphere representation)

**Outputs**
- A minimal diagnostics function called directly within synthetic notebooks.

**Success Criterion**  
A quick diagnostic call can reliably indicate whether a synthetic run is good or broken.

---

## Phase 0.2.5 ‚Äî AIST++ Loader & Baseline Real-Data Run

**Purpose**  
Establish the first complete real-data path through Stage 2+3.

**Dataset**  
**AIST++**, chosen because:
- Clean skeleton  
- Clear calibration  
- Manageable file sizes  
- Good camera coverage  
- High chance of early success and stable priors

**Scope**
- Implement loader + joint mapping to GIMBAL skeleton.  
- Produce:
  - `y_obs (C,T,K,2)` for cameras  
  - `x_gt (T,K,3)` if ground truth available  
- Run Stage 2+3 with:
  - sampler from 0.2.3  
  - coarse anatomical + EB priors  
  - minimal diagnostics  

**Outputs**
- A baseline real-data notebook demonstrating an end-to-end working run.

---

## Phase 0.2.6 ‚Äî Real-Data Diagnostics + Data-Driven Anatomical Priors

**Purpose**  
Move from ‚Äúbaseline runs‚Äù to **validated** and **interpretable** real-data performance.

**Diagnostics (Numeric)**
- MPJPE  
- Bone-length consistency error  
- Velocity / acceleration error

**Diagnostics (Visual)**
- Ground-truth vs reconstructed trajectory plots  
- Joint-specific error-over-time plots  
- Synchronized pose timeline with inferred HMM states  
- Transition and dwell-time visuals

**Data-Driven Anatomical Priors**
- Use AIST++ pose distributions to refine joint-direction priors and typical Œ∫ ranges.  
- Replace or sharpen the coarse priors from 0.2.1.

**Outputs**
- A real-data diagnostic suite  
- Dataset-grounded anatomical priors

**Success Criterion**  
We can judge improvements/regressions across future phases, and fits look anatomically plausible.

---

## Phase 0.2.7 ‚Äî Coarse PCA + Low-D HMM + Transition Upsampling

**Purpose**  
Learn state dynamics in a stable low-D space, and project them to full-frame rate.

**Scope**
- Downsample sequences (e.g., 60 ‚Üí 6 Hz) after linear interpolation to eliminate NaNs.  
- PCA on full-pose vectors to ~80% variance.  
- Fit low-D directional HMMs for several S values.  
- For each candidate S:
  - compute coarse-rate transitions `A_low`  
  - upsample to full rate `A_high` using matrix-root / exp-log conversion  
  - optionally compute coarse state sequences  

**Outputs**
- PCA embedding  
- Low-D HMM state means and spreads  
- Full-rate transition prior matrices for each S

**Success Criterion**  
Coarse states and transitions look reasonable and improve subsequent fits.

---

## Phase 0.2.8 ‚Äî PCA-Informed Priors & State-Number Selection

**Purpose**  
Use PCA-level dynamics and geometry to inform full Stage-3 priors, then select S.

**Scope**
- Map PCA-level state means back to full-pose joint directions ‚Üí priors on `mu`.  
- Derive Œ∫ priors from PCA-level state variability.  
- Use `A_high` as Dirichlet transition priors.  
- Fit full Stage 3 for each candidate S on AIST++ sequences.  
- Compare using:
  - real-data metrics  
  - HMM diagnostic plots  
  - model comparison (LOO/WAIC held-out performance if viable)  

**Outputs**
- PCA-informed full-model priors  
- Final or narrowed selection of S  
- Stable, interpretable full-rate HMM fits on real data

---

# üîÆ Deferred Ideas (Not in v0.2)

These are valuable but intentionally postponed until v0.3 or beyond:

1. Validation across multiple public datasets (Human3.6M, 3DPW, TotalCapture, etc.)  
2. Grouped / hierarchical Œ∫ structures  
3. Variational Bayes for warm starts or rapid screening  
4. DP-HMM / nonparametric dynamic state models  
5. Full code cleanup + notebook triage  
6. ‚ÄúSupported workflows‚Äù documentation  
7. Robust outlier / mixture emission models  
8. Multimodal (IMU + cameras) extensions  
9. Behavior-segmentation tools built on HMM outputs  
10. Motion-primitive extraction / clustering from learned states  

---

# ‚úî Summary

v0.2 builds a stable, validated, real-data-capable HMM pipeline through:

- Early stabilizing priors  
- Early clustering-based EB priors  
- Early sampler decision  
- Early minimal diagnostics  
- Early real-data integration with AIST++  
- Real-data anatomical priors  
- PCA-based low-D HMM and transition upsampling  
- Full pose-space priors and state-number selection  

By the end of v0.2, we will have a fully functioning, diagnosable, real-data-ready HMM pipeline with informed priors, validated performance, and a clean mechanism for selecting the number of states.
