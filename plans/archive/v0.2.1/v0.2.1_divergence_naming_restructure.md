# GIMBAL v0.2.1 — Divergence Debugging Naming & Organization Restructure

**Status:** Proposal  
**Date:** 2025-12-14  
**Purpose:** Establish clear, scalable naming conventions for divergence debugging artifacts

---

## Executive Summary

The v0.2.1 divergence debugging effort has produced:
- 2 overlapping plan documents
- 11+ test groups with inconsistent naming (TG1-8 from old plan, TG9-11 from new plan)
- 3 conceptual "issues" that need stable identifiers
- Multiple deep-dive debugging documents without clear hierarchy

This document proposes a **minimal, preserving restructure** that:
- ✅ Keeps all existing files (no deletion)
- ✅ Establishes stable Issue IDs (I1, I2, I3)
- ✅ Maps test groups to issues explicitly
- ✅ Clarifies which document is canonical
- ✅ Scales to future work without renaming

---

## 1. File Mapping Table

### A. Plan Documents

| Current Filename | Proposed Filename | Role | Status |
|------------------|-------------------|------|--------|
| `v0.2.1_divergence_plan_2.md` | **KEEP** (canonical roadmap) | Master divergence plan | Active |
| `v0.2.1_divergence_test_plan.md` | → `v0.2.1_divergence_TG01-08_archive.md` | Archive of TG1-8 (superseded) | Archive |
| *(new)* | `v0.2.1_divergence_I1_root_dynamics.md` | I1 deep dive (if needed) | Future |
| *(new)* | `v0.2.1_divergence_I2_camera_conditioning.md` | I2 deep dive | Future |
| *(new)* | `v0.2.1_divergence_I3_redundancy.md` | I3 deep dive | Future |

**Rationale:**
- One clear canonical plan (`_plan_2.md`)
- Old test plan renamed to show it's an archive of TG1-8
- Future deep dives use stable Issue IDs (I1, I2, I3)

### B. Test Scripts

| Current Filename | Proposed Filename | Maps To | Status |
|------------------|-------------------|---------|--------|
| `test_group_1_baseline_no_hmm.py` | `test_tg01_baseline_no_hmm.py` | TG01 (archive) | Archive |
| *(TG2-8 similar)* | `test_tg0X_*.py` | TG02-08 (archive) | Archive |
| `test_group_9_root_fixed.py` | `test_tg09_I1_root_fixed.py` | I1: Root RW | Active |
| `test_group_10_direct_3d.py` | `test_tg10_I2_direct_3d.py` | I2: Camera | Active |
| `test_group_11_redundancy_fixed.py` | `test_tg11a_I3_redundancy_fixed.py` | I3: Redundancy (variant A) | Active |
| `test_group_11_redundancy_priors.py` | `test_tg11b_I3_redundancy_priors.py` | I3: Redundancy (variant B) | Active |

**Rationale:**
- Zero-padded `tg01`, `tg02`, etc. for proper sorting
- Issue ID in filename (I1, I2, I3) shows conceptual bucket
- TG11 split into 11a/11b (letters, not decimals) for subvariants
- Old test groups (1-8) preserved but marked as archive tier

### C. Report Files

| Current Filename | Proposed Filename | Maps To |
|------------------|-------------------|---------|
| `report_group_1_baseline_no_hmm.md` | `report_tg01_baseline_no_hmm.md` | TG01 |
| `report_group_9_root_fixed.md` | `report_tg09_I1_root_fixed.md` | TG09/I1 |
| *(future)* | `report_tg10_I2_direct_3d.md` | TG10/I2 |
| *(future)* | `report_tg11a_I3_redundancy_fixed.md` | TG11a/I3 |
| *(future)* | `report_tg11b_I3_redundancy_priors.md` | TG11b/I3 |

**Rationale:**
- Report filenames mirror test filenames exactly
- Machine-parseable mapping (report_tgNN → test_tgNN)

### D. Results JSON Files

| Current Filename | Proposed Filename |
|------------------|-------------------|
| `results_group_1_baseline_no_hmm.json` | `results_tg01_baseline_no_hmm.json` |
| `results_group_9_root_fixed.json` | `results_tg09_I1_root_fixed.json` |
| *(etc.)* | *(etc.)* |

---

## 2. Issue Registry (Stable IDs)

### Issue I1: Root Dynamics / Temporal Coupling
**Hypothesis:** Hierarchical root RW (`sigma_root` + `x_root[t] ~ GRW`) creates funnel geometry.  
**Test Groups:** TG09  
**Status (2025-12-14):** Anchoring implemented, but 100% divergences persist. Root parameterization correct but insufficient. Evidence points to I2 as root cause.

### Issue I2: Camera Conditioning / Projection Geometry
**Hypothesis:** Camera projection layer induces pathological curvature, especially when coupled with root dynamics.  
**Test Groups:** TG10  
**Status (2025-12-14):** Identified as likely root cause (fixed root → 0% divs, anchored root → 100% divs).

### Issue I3: Parameter Redundancy / Identifiability
**Hypothesis:** Directions, lengths, and root are not fully identified by camera observations.  
**Test Groups:** TG11a, TG11b  
**Status (2025-12-14):** Not yet validated; may be masked by I2.

### Archive: Test Groups 1-8 (Pre-Issue Framework)
**Test Groups:** TG01-08  
**Status:** Completed under old plan (`v0.2.1_divergence_test_plan.md`), now superseded by Issue framework.

---

## 3. Test Group Registry

| TG ID | Issue | Slug | Baseline Variant | Diagnostic Variant | Status |
|-------|-------|------|------------------|--------------------|--------|
| TG01 | *(pre-issue)* | baseline_no_hmm | Full model, HMM off | *(none)* | Archive |
| TG02 | *(pre-issue)* | hmm_effect | HMM off | HMM on | Archive |
| TG03 | *(pre-issue)* | state_count | S=3 | S=1, S=2 | Archive |
| TG04 | *(pre-issue)* | likelihood_scale | Standard | Rescaled likelihood | Archive |
| TG05 | *(pre-issue)* | divergence_localization | *(diagnostic)* | *(diagnostic)* | Archive |
| TG06 | *(pre-issue)* | root_variance | *(hierarchical)* | *(fixed variance)* | Archive |
| TG07 | *(pre-issue)* | bone_length_variance | *(hierarchical)* | *(fixed variance)* | Archive |
| TG08 | *(pre-issue)* | runtime_scaling | T=50, T=100, T=200 | *(scaling study)* | Archive |
| **TG09** | **I1** | **root_fixed** | Anchored root RW | Fixed root (DLT) | **Active** |
| **TG10** | **I2** | **direct_3d** | Camera likelihood | Direct 3D Gaussian | **Pending** |
| **TG11a** | **I3** | **redundancy_fixed** | Free directions/lengths | Fixed to GT | **Pending** |
| **TG11b** | **I3** | **redundancy_priors** | Weak priors | Strong GT-based priors | **Pending** |

---

## 4. Rationale: Why This Scheme Works

### A. Stable Conceptual Buckets (Issues)
- **I1, I2, I3** are never reused or renumbered
- New issues get I4, I5, etc.
- Issues are conceptual hypotheses, not test results

### B. Traceable Test Units (TG##)
- Test groups are audit units with one report each
- Zero-padded for proper sorting (TG01, TG02, not TG1, TG2)
- Letters for subvariants (TG11a, TG11b) avoid confusion with decimals

### C. One Canonical Roadmap
- `v0.2.1_divergence_plan_2.md` is the single source of truth
- Other docs are archives or deep dives, clearly labeled
- No ambiguous "plan_3" or "plan_2_revised_final"

### D. Machine-Parseable
- Filenames encode structure: `test_tg09_I1_root_fixed.py`
- Easy to grep: `ls test_tg*` or `grep "TG09"`
- Report/test/results all share same slug

### E. Scales Forward
- Adding TG12 (new hypothesis) → `test_tg12_I4_new_slug.py`
- Adding TG10c (third variant) → `test_tg10c_I2_variant.py`
- No need to renumber existing work

---

## 5. Migration Strategy

### Phase 1: Non-Breaking Renames (Immediate)
1. Rename old test plan:
   ```
   v0.2.1_divergence_test_plan.md → v0.2.1_divergence_TG01-08_archive.md
   ```
2. Add header to archive noting it's superseded by `_plan_2.md`

### Phase 2: Test File Renames (Git mv)
```bash
# Archive tier (TG01-08) - optional, low priority
git mv test_group_1_baseline_no_hmm.py test_tg01_baseline_no_hmm.py

# Active tier (TG09-11)
git mv test_group_9_root_fixed.py test_tg09_I1_root_fixed.py
git mv test_group_10_direct_3d.py test_tg10_I2_direct_3d.py
git mv test_group_11_redundancy_fixed.py test_tg11a_I3_redundancy_fixed.py
git mv test_group_11_redundancy_priors.py test_tg11b_I3_redundancy_priors.py
```

### Phase 3: Update Internal References
1. Update `test_runner.py` imports
2. Update function names (`run_group_9_root_fixed` → `run_tg09_I1_root_fixed`)
3. Update report/results filenames in test scripts

### Phase 4: Update Canonical Plan
Add "Status / Pointers" section to `v0.2.1_divergence_plan_2.md` (see Section 6)

---

## 6. Proposed Edit for Canonical Plan

Add this section immediately after the document header in `v0.2.1_divergence_plan_2.md`:

```markdown
---

## Status & Organization (Updated 2025-12-14)

### Naming Convention
This plan uses **stable Issue IDs** (I1, I2, I3) and **Test Group IDs** (TG09, TG10, TG11a, TG11b).

- **Issue I1 (Root Dynamics):** See TG09 results — anchoring implemented but insufficient (100% divs persist)
- **Issue I2 (Camera Conditioning):** TG10 (pending) — likely root cause based on TG09 fixed-root success
- **Issue I3 (Redundancy):** TG11a/TG11b (pending) — may be masked by I2

### Archive
Test Groups 1-8 (from `v0.2.1_divergence_TG01-08_archive.md`) completed under pre-Issue framework.

### Related Documents
- **Test script naming:** `test_tg##_I#_slug.py` (e.g., `test_tg09_I1_root_fixed.py`)
- **Reports:** `report_tg##_I#_slug.md`
- **Deep dives (future):** `v0.2.1_divergence_I#_topic.md`

---
```

**Placement:** Insert between the "Editor Note" and "Issue #1" sections.

---

## 7. Future Guidelines

### Adding a New Test Group
1. Choose next available TG ID (e.g., TG12)
2. Determine which Issue it addresses (or create I4 if new)
3. Name file: `test_tg12_I4_short_slug.py`
4. Generate report: `report_tg12_I4_short_slug.md`
5. Update canonical plan with one-line summary

### Adding a New Issue
1. Choose next available Issue ID (e.g., I4)
2. Document hypothesis in canonical plan under new section
3. Create deep-dive doc if needed: `v0.2.1_divergence_I4_topic.md`
4. Plan test groups (TG##) to validate

### Retiring / Archiving
- Mark test group status as "Archive" in registry
- Do not delete files
- Add note to canonical plan

---

## 8. Summary

This restructure:
- ✅ Preserves all history
- ✅ Establishes I1/I2/I3 as stable conceptual buckets
- ✅ Uses TG## with zero-padding for clear sorting
- ✅ Makes one canonical plan obvious
- ✅ Enables machine parsing and grep-ability
- ✅ Scales to future work without renaming chaos

**Next Steps:**
1. Review and approve this proposal
2. Execute Phase 1 (rename archive doc)
3. Execute Phase 2 (rename test files via git mv)
4. Execute Phase 3 (update imports/references)
5. Execute Phase 4 (update canonical plan)
