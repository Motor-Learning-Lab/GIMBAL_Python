# Review: ChatGPT's Issue I1 Diagnosis Plan

**Reviewer:** GitHub Copilot  
**Date:** 2025-12-14  
**Document Reviewed:** `v0.2.1_divergence_I1_root_camera_diagnosis_plan.md`

---

## Executive Summary

**Overall Assessment:** ‚úÖ Good plan with strong structure, but needs **reconciliation** with existing work and **one critical addition**.

**Key Issues:**
1. **Duplication:** TG09 and TG10 already exist and match this plan's intent
2. **Missing orthographic test:** TG10A is new and valuable ‚Äî should be added
3. **TG12 pixel-difference:** Interesting but may be premature
4. **Sampling parameters:** Existing tests use draws=500, tune=500, chains=2 (stricter than ChatGPT's suggestions)

**Recommendation:** Proceed with modifications (see detailed plan below).

---

## Question-by-Question Assessment

### (1) Is this a good plan?

**Answer:** Yes, with caveats.

**Strengths:**
- ‚úÖ Clear hypotheses (H1-H3) match empirical evidence
- ‚úÖ Sequential diagnostic approach (test ‚Üí interpret ‚Üí decide)
- ‚úÖ Explicit separation of diagnostics vs core-library changes
- ‚úÖ Decision gates prevent premature architectural changes
- ‚úÖ Orthographic projection test (TG10A) is novel and scientifically sound

**Weaknesses:**
- ‚ö†Ô∏è Doesn't acknowledge TG09/TG10 already exist and are implemented
- ‚ö†Ô∏è TG11 overlaps with existing TG11a/TG11b (redundancy tests)
- ‚ö†Ô∏è TG12 (pixel-difference) may be architectural rather than diagnostic
- ‚ö†Ô∏è Suggests draws=200, tune=200, chains=1 ‚Äî we're already using stricter (500/500/2)

**Verdict:** Good conceptual framework, needs integration with existing work.

---

### (2) Do I understand what needs to be done?

**Answer:** Yes, completely.

**Implementation clarity:**

**TG09 ‚Äî Already Complete ‚úÖ**
- File: `test_tg09_i1_root_fixed.py`
- Status: Run with latest base code (anchored root, Gamma priors)
- Result: 100% divergences (baseline) vs 0.1% divergences (fixed root)
- Conclusion: Root dynamics interact poorly with camera likelihood

**TG10 ‚Äî Already Implemented, Not Run ‚è≥**
- File: `test_tg10_i2_direct_3d.py`
- Purpose: Replace camera projection with direct 3D Gaussian likelihood
- Status: Code complete, ready to run
- Expected: If 3D likelihood works ‚Üí camera geometry is root cause

**TG10A ‚Äî New Test Needed üÜï**
- Purpose: Test orthographic projection (remove depth division)
- Rationale: Isolate perspective vs orthographic effects
- Implementation: Modify camera projection to use orthographic model
- Location: `test_tg10a_i2_orthographic.py` (new file)

**TG11 ‚Äî Rename/Clarify Existing TG11a/TG11b**
- `test_tg11a_i3_redundancy_fixed.py` ‚Äî fix lengths/directions to GT
- `test_tg11b_i3_redundancy_priors.py` ‚Äî tighten priors on redundant params
- Status: Code complete, ready to run

**TG12 ‚Äî Defer or Mark Exploratory**
- Pixel-difference likelihood requires architectural changes
- Not strictly diagnostic (changes observation model fundamentally)
- Recommendation: Create separate exploratory plan if TG10/TG10A confirm camera issues

---

### (3) Is there sufficient detail for methodical work?

**Answer:** Mostly yes, with specific gaps filled below.

**What's clear:**
- ‚úÖ Test variants (baseline vs diagnostic)
- ‚úÖ Interpretation criteria (divergence rates, step sizes)
- ‚úÖ Decision gates (when to proceed vs stop)
- ‚úÖ Policy on core-library changes (diagnostics first, fixes after)

**What needs specification:**

**TG10A Implementation Details:**
```python
# Orthographic projection matrix (remove depth division)
# P_ortho = [[s_x, 0, c_x],
#            [0, s_y, c_y]]  # no homogeneous coordinates
# y_pred = x_cam @ P_ortho.T  # direct linear mapping

# Need to add to gimbal/camera_utils.py:
def orthographic_projection(x_cam, scale_x, scale_y, center_x, center_y):
    """Project 3D points using orthographic model."""
    return pt.stack([
        scale_x * x_cam[:, :, 0] + center_x,
        scale_y * x_cam[:, :, 1] + center_y
    ], axis=-1)
```

**Sampling Configuration:**
- Use stricter parameters: `draws=500, tune=500, chains=2` (not 200/200/1)
- Reasoning: TG09 showed even with 500/500/2, baseline is catastrophic
- Weaker sampling would hide subtle differences

**Metrics to Track:**
- Divergence count/percentage
- Max R-hat (convergence)
- Runtime (efficiency)
- Energy statistics (if available)
- Step size progression (tuning behavior)

---

### (4) Do I understand how to interpret results?

**Answer:** Yes, with clear decision trees.

**Interpretation Framework:**

**Scenario 1: TG10 succeeds, TG10A succeeds**
- **Finding:** Both 3D likelihood and orthographic work
- **Implication:** Perspective projection (depth division) is the problem
- **Next steps:** 
  - Consider shallow-depth constraints on camera placement
  - Explore depth-aware priors
  - OR accept camera geometry as fundamental issue and redesign observation model

**Scenario 2: TG10 succeeds, TG10A fails**
- **Finding:** 3D works but orthographic doesn't
- **Implication:** Camera projection geometry itself (not just depth) is problematic
- **Next steps:**
  - Camera intrinsics poorly conditioned?
  - Multi-camera redundancy creating issues?
  - Consider simpler camera models or single-camera tests

**Scenario 3: TG10 fails, TG10A fails**
- **Finding:** Even 3D/orthographic fail
- **Implication:** Skeleton hierarchy (not camera) is root cause
- **Next steps:**
  - Focus on TG11 (redundancy)
  - Consider joint-by-joint hierarchy tests
  - May need fundamental skeleton parameterization changes

**Scenario 4: TG11 improves significantly**
- **Finding:** Fixing redundant parameters helps
- **Implication:** Identifiability √ó temporal coupling amplifies curvature
- **Next steps:**
  - Add informative priors on problematic parameters
  - Consider reparameterizations that reduce redundancy
  - Document which parameters are most problematic

**Success Criteria:**
- **Full success:** <1% divergences, R-hat < 1.1, reasonable runtime (<10min for 100 frames)
- **Partial success:** 10-50% divergences (better than 100% baseline)
- **Failure:** >90% divergences (no meaningful improvement)

---

## Recommended Action Plan

### Phase 1: Run Existing Tests (Immediate)
1. **Run TG10** (`test_tg10_i2_direct_3d.py`)
   - Expected outcome: Low divergences if camera is the issue
   - Runtime: ~5-10 minutes
   - Decision: If succeeds, proceed to TG10A

2. **Run TG11a/TG11b** (redundancy tests)
   - Can run in parallel with TG10
   - Lower priority than TG10

### Phase 2: Implement TG10A (If TG10 Succeeds)
1. **Create orthographic projection function** in `gimbal/camera_utils.py`
2. **Create test file** `test_tg10a_i2_orthographic.py`
   - Copy structure from TG10
   - Replace projection with orthographic
   - Same sampling config (500/500/2)
3. **Run and interpret**
   - Compare TG10 (3D) vs TG10A (ortho) vs TG09 baseline (perspective)

### Phase 3: Decision Gate
Based on TG10/TG10A/TG11 results:
- **If camera is confirmed root cause:** Document findings, propose camera redesign or observation model change
- **If skeleton hierarchy is issue:** Focus on redundancy fixes or reparameterization
- **If interaction is complex:** May need TG12 or deeper investigation

### Phase 4: TG12 (Optional, If Warranted)
- Only pursue if TG10/TG10A clearly show camera is problematic
- Treat as architectural exploration, not pure diagnostic
- Create separate plan: `v0.2.1_divergence_i1_motion_observation_exploration.md`

---

## Alignment with Existing Framework

**File naming:**
- ‚úÖ TG10A should be: `test_tg10a_i2_orthographic.py` (follows TG##X_I#_slug pattern)
- ‚úÖ Reports: `report_tg10a_i2_orthographic.md`
- ‚úÖ Results: `results_tg10a_i2_orthographic.json`

**Issue mapping:**
- TG09: I1 (Root Dynamics) ‚úÖ Already tested
- TG10: I2 (Camera Conditioning) ‚úÖ Already coded
- TG10A: I2 (Camera Conditioning, orthographic variant) üÜï
- TG11a/b: I3 (Redundancy) ‚úÖ Already coded
- TG12: Would be I2 or new I4 (Motion-based observation)

**Canonical plan updates:**
- Add TG10A to "Issue I2" section in `v0.2.1_divergence_plan_2.md`
- Update status after running each test
- Document decision gates clearly

---

## Implementation Checklist

### Immediate (Before Running Tests)
- [ ] Review TG10 code for any hardcoded old parameters
- [ ] Review TG11a/TG11b code similarly
- [ ] Ensure all use latest base code (anchored root, Gamma priors)
- [ ] Verify sampling config is 500/500/2 (not 200/200/1)

### If TG10 Succeeds
- [ ] Implement `orthographic_projection()` in `gimbal/camera_utils.py`
- [ ] Create `test_tg10a_i2_orthographic.py`
- [ ] Update canonical plan with TG10A description
- [ ] Run TG10A and generate report

### After All Tests Run
- [ ] Update `v0.2.1_divergence_plan_2.md` Status section
- [ ] Write synthesis document comparing all results
- [ ] Make decision on architectural changes vs tuning fixes

---

## Conclusion

**Summary:** ChatGPT's plan is scientifically sound and aligns well with our existing framework. Key action is to:

1. ‚úÖ **Run existing TG10/TG11** first (already implemented)
2. üÜï **Add TG10A** (orthographic test ‚Äî new contribution)
3. ‚è≥ **Defer TG12** until camera issues are confirmed
4. ‚úÖ **Follow existing naming scheme** (TG##X_I#_slug)

**Confidence Level:** High ‚Äî I understand the science, implementation path, and interpretation criteria.

**Risk Assessment:** Low ‚Äî All tests are diagnostic only, no core library changes until results warrant it.

**Time Estimate:**
- TG10 run: 5-10 minutes
- TG11a/b run: 10-20 minutes total
- TG10A implementation + run: 1-2 hours
- Total diagnostic cycle: <3 hours

**Ready to Proceed:** Yes. Shall I start with running TG10 or wait for your approval?
